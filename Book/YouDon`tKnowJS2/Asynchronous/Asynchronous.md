## 비동기성: 지금과 나중

- 비동기
  - 자바스크립트에 비동기란 개념이 있었던 적이 없다. (비동기 자바스크립트 코드를 쭉 작성해 왔다 해도)
  - 자바스크립트 엔진은 **요청**하면 프로그램을 주어진 시점에 한 덩이씩 묵묵히 실행한다.
  - 요청? 자바스크립트 엔진은 반드시 호스팅에서 실행된다. (가장 흔한 호스팅 환경은 웹 브라우저) 자바스크립트는 브라우저를 벗어나 영역을 확장해왔다. (ex: Node JS)
  - 환경은 달라도 스레드는 공통이다. 여러 프로그램 덩이를 시간에 따라 매 순간 한번씩 엔진을 실행시키는 이벤트 루프라는 장치다.
  - 정리하면 자바스크립트 엔진은 애당초 시간이란 관념 따윈 없었고, 임의의 자바스크립트 코드 조각을 시시각각 주는 대로 받아 처리하는 **실행기**일뿐,
    **이벤트(자바스크립트 코드 실행)**를 스케줄링 하는 일은 언제나 엔진을 감싸고 있던 주위 환경의 몫

```Javascript

    // 'eventLoop'는 큐(선입, 선출) 역할을 하는 배열이다.
    var eventLoop = [];
    var event;

    // '무한 실행!'
    while (true) {
        // 발생
        if (eventLoop.length > 0) {
            // 큐에 있는 다음 이벤트 조회
            event = eventLoop.shift();
            // 이제 다음 이벤트 실행
            try {
                event();
            } catch (err) {
                reprtError(err);
            }
        }
    }

```

- 위 코드엔 while 무한 루프가 있는데 이 루프의 매 순회를 틱 이라고 한다. 틱이 발생할 떄마다 큐에 적재된 이벤트(콜백 함수)를 꺼내어 실행한다.
- setTimeout()은 콜백을 이벤트 루프 큐에 넣지 않는다. setTimeout()은 타이머를 설정하는 함수다.
  타이머가 끝나면 환경이 콜백을 이벤트 루프에 삽입한 뒤 틱에서 콜백을 꺼내어 실행한다.
- 즉, 자바스크립트 프로그램은 수많은 덩이로 잘게 나누어지고 이벤트 루프 큐에서 한 번에 하나씩 차례대로 실행된다.
- 그러나 ES6부터는 이벤트 루프 큐 관리 방식이 완전히 바꼈다. 이제는 호스팅 환경이 아닌 자바스크립트 엔진의 관할이 됐다.
- 2부 3장 프라미스 도입을 계기로 이러한 변화가 일어났는데, 프라미스는 이벤트 루프 큐의 스케줄링을 직접 세밀하게 제어해야 하기 때문! (나중에 자세히 살펴보자)
