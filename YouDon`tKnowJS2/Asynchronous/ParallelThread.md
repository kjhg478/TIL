## 병렬 스레딩

- 프로세스 : 실행 중인 프로그램 (운영 체제는 프로세스를 사용하여 실행 중인 애플리케이션을 분리)
- 스레드 : 어떠한 프로그램 내에서, 특히 프로세스 내에서 실행되는 흐름의 단위 (일반적으로 한 프로그램은 하나의 스레드를 가지고 있다.)
- 멀티스레드 : 프로그램 환경에 따라 둘 이상의 스레드를 동시에 실행할 수 있다.

- 병렬 스레딩

  - 비동기와 병렬은 완전히 다르다.
  - 비동기는 지금과 나중 사이의 간극에 관한 용어이고, 병렬은 동시에 일어나는 일들과 연관된다.
  - 프로세스와 스레드는 가장 많이 쓰는 병렬 컴퓨팅 도구로, 별개의 프로세서,
    물리적으로 분리된 컴퓨터에서도 독립적으로 (때로는 동시에) 실행되며 여러 스레드는 하나의 프로세스 메모리를 공유한다.
  - 반면, 이벤트 루프는 작업단위로 나누어 차례대로 실행하지만 공유 메모리에 병렬로 접근하거나 변경할 수는 없다.

- 단일-스레드 환경

  - 스레드 간섭은 일어나지 않으므로 스레드 큐에 저수준 작업의 원소가 쌓여 있어도 별 문제가 없다.
  - 하지만 하나의 프로그램에서 여러 스레드를 처리하는 병렬 시스템에선 예상치 못한 일들이 일어날 수 있다.

  ```Javascript
      var a = 20;

      function foo() {
          a = a + 1;
      }
      function bar() {
          a = a * 2;
      }

      ajax("http://some.url.1", foo);
      ajax("http://some.url.1", bar);

  ```

  - 자바스크립트는 단일-스레드로 작동하니까 foo() -> bar() 순서로 실행하면 결괏값은 42지만 반대로 bar() -> foo() 순서면 41이 된다.
  - 같은 데이터를 공유하는 자바스크립트 이벤트의 병렬 실행 문제는 더 복잡하다.
  - 만약, 두 스레드가 진짜 병렬 상태로 실행되면 X, Y라는 임시 메모리가 있다는 가정하에 중간 단계의 메모리 공간을 공유하는 것이 문제가 된다.
  - 병렬 상태로 실행하게 되면 제멋대로 왔다 갔다 하는 결괏값 때문에 고생하게 될 것이다.

#### 자바스크립트는 절대로 스레드 간에 데이터를 공유하는 법이 없어서, 비결정성의 수즌은 문제가 되지 않는다.

- 완전-실행

  - 자바스크립트의 작동 모드는 단일-스레드이므로 foo(), bar() 내부의 코드는 원자적이다.
  - 일단 foo()가 실행되면 함수 전체 코드가 실행되고 나서야 bar() 함수로 옮아간다는 뜻이다. 이를 완전-실행(Run-to-Completion)이라 한다.

  ```Javascript
      var a = 1;
      var b = 2;

      function foo() {
          a++;
          b = b * a;
          a = b + 3;
      }

      function bar() {
          b--;
          a = 8 + b;
          b = a * 2;
      }

      ajax("http://some.url.1", foo);
      ajax("http://some.url.1", bar);

      // 덩이 1
      var a = 1;
      var b = 2;

      // 덩이 2
      foo()

      // 덩이 3
      bar()

      // 결과 1
      a; // 11
      b; // 22

      // 결과 2
      a; // 183
      b; // 180

  ```

  - foo()와 bar()는 상대의 실행을 방해할 수 없으므로 이 프로그램의 결괏값은 먼저 실행되는 함수가 좌우한다.
  - 만약 Statement(문) 단위로 스레딩이 일어나면 문별 인터리빙이 발생하여 경우의 수는 기하급수적으로 늘어난다.
  - 덩이 1은 (지금 실행중인) 동기 코드고 덩이 2와 3은 (나중에 실행될) 비동기 코드로 일정 시간 차이를 두고 실행된다.
  - 덩이 2와 덩이 3은 선발순으로 실행된다.
  - 똑같은 코드인데 결괏값은 두 가지이므로 이 프로그램은 비 결정적이다.
  - 그러나 여기서 비결정성은 함수(이벤트)의 순서에 따른 것이지, 스레드처럼 문의 순서(표현식의 처리 순서) 수준까지는 아니다. (스레드보다 결정적)
